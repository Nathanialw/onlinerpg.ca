'use strict'

import {Create_Map_Line, Draw_UI, Draw_Vision_Background} from '../graphics/graphics.js';
import {Set_Enemies, Set_Player, Set_Objects} from '../objects/objects.js';

let mapDisplay = [];
let fill = [];

//should be saved as character data

// for testing start

// let mapString = "\
// ###################################################################################################\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// #.................................................................................................#\
// ###################################################################################################";
// let mapWidth = 99;
// Make_Map(mapString, mapWidth);
// let units = "H0303g0349o2357g0342g0349g4349g3349";
// Populate_Map(units)

// for testing end



// instead this function should create a blank map of . and it should get filled in in 8x8 chunks from the server as the player moves, 
export function Make_Map(serverMap, visionWidth) {
    console.log("Redrawing Game");
    Draw_UI();
    Draw_Vision_Background(visionWidth);
    for (let i = 0; i < visionWidth; i++) {
        // render lines of the map
        let mapLine = serverMap.substring(i * visionWidth, (i * visionWidth) + visionWidth); // 0, 13 -> 13, 26 -> 26, 39
        mapDisplay[i] = Create_Map_Line(mapLine, i, visionWidth);
    }
}

export function Map(data) {
    let visionWidth = parseInt(data.substring(0, 2), 10);
    let serverMap = data.substring(2);
    Make_Map(serverMap, visionWidth);
}

export function Update_Map(serverMap, mapWidth) {
    // for (let i = 0; i < mapWidth; i++) {
    //     let object = serverMap.substring((i * mapWidth), ((i * mapWidth) + mapWidth));
    //     mapDisplay[i] = Create_Map_Line(object, i);
    // }
}

let Update = {
    "@": Set_Player,
    "g": Set_Enemies,
    "o": Set_Objects,
}

// I should use a seperate function to grab the correct substring from the unitOnMap string
export function Populate_Map(unitsOnMap) {
    for (let i = 0; i < unitsOnMap.length; i += 5) {        
        // let object = Create_Object(unitsOnMap[i], unitsOnMap.substring(i+1,i+3), unitsOnMap.substring(i+3,i+5));
	    // Update[unitsOnMap[i]](object)
        Update[unitsOnMap[i]](unitsOnMap.substring(i, i + 5));
    }
}
